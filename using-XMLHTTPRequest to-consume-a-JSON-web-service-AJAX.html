<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>CIT 261 - XMLHTTPRequest, AJAX</title>
	<link rel="stylesheet" type="text/css" href="style.css" media="screen">	
	
	<script type="text/javascript">
		var xhttp = new XMLHttpRequest();
		
		function getObject(){
			var xmlhttp = new XMLHttpRequest();
			
			xmlhttp.onreadystatechange = function (){
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200){
					var response = JSON.parse(this.responseText);
					handleManualObjectResponse(response);
				}
			}
			
			var input = document.getElementById('objectInput').value;
			
			xmlhttp.open("GET", "/object_string/" + input + ".txt", true);
			xmlhttp.send();
		
		
		}
		
		function handleManualObjectResponse(response){
		
			var output = "";
			
			for (var i = 0; i < response.length; i++){
				output += response[i] + "<br>";
			}
			
			document.getElementById('objectOutput').innerHTML = output;
		
		}
			
		function process(){
			if (xhttp.readyState == 0 || xhttp.readyState == 4){
				console = encodeURIComponent(document.getElementById('reviewInput').value);
				
				xhttp.open("GET", "/object_string/consoles.php?console=" + console, true);
				
				xhttp.onreadystatechange = handleServerResponse;
				
				xhttp.send();
			} else{
				setTimeout('process()', 1000);
			}
		}
		
		function handleServerResponse(){
			if (xhttp.readyState == 4 && xhttp.status == 200){
				xmlResponse = xhttp.responseXML;
				xmlDocumentElement = xmlResponse.documentElement;
				message = xmlDocumentElement.firstChild.data;
				
				document.getElementById("reviewOutput").innerHTMl = '<br><span \n\ style="color:purple">' + message + '</span>';
				
				setTimeout("process()", 1000);
			}
		}
		
	</script>
	
</head>

<body>
	<header>
	<a href="index.html">
		<h1>CIT 261 - Kailey Dilworth</h1>
		<h2>Application Development</h2>
	</a>
	</header>
	<div class="background">
		<h2>Using XMLHTTPRequest to Consume a JSON Web Service (AJAX):</h2>
		<h3>My Favorite Games:</h3>
		<select id="objectInput">
			<option value="kingdomHearts">Kingdom Hearts</option>
			<option value="sonic">Sonic 3 and Knuckles</option>
			<option value="starfox">Star Fox 64</option>
			<option value="undertale">Undertale</option>
			<option value="finalfantasy9">Final Fantasy IX</option>
		</select>
		<button type="button" onclick="getObject()">See Details</button>
		<button onclick="clearObjectOutput()">Clear</button>
		<div id="objectOutput"></div>
		<h3>My Consoles:</h3>
		<select id='reviewInput'>
			<option></option>
			<option>NES</option>
			<option>SNES</option>
			<option>Nintendo 64</option>
			<option>Gamecube</option>
			<option>Wii</option>
			<option>Wii U</option>
			<option>Switch</option>
			<option>Playstation 1</option>
			<option>Playstation 2</option>
			<option>Playstation 3</option>
			<option>Playstation 4</option>
			<option>Xbox</option>
			<option>Xbox 360</option>
			<option>Xbox One</option>
			<option>Gameboy Color</option>
			<option>Gameboy Advanced</option>
			<option>3DS</option>
			<option>PSP</option>
			<option>PSVita</option>
		</select>
		<div id="reviewOutput"></div>

	<footer>
		<p>Copyright 2017 - Kailey Dilworth</p>
	<footer>
	</div>
	
	</body>
</html>